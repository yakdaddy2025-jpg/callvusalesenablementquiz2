{
  "form": {
    "accessibility": false,
    "actions": [],
    "approveData": {
      "enabled": false,
      "forceApproveBeforeShowingDownload": false,
      "toCloseForm": false,
      "popupObj": {
        "errorMsg": "",
        "fieldType": "",
        "message": "",
        "title": ""
      },
      "submitIcon": ""
    },
    "calculatedFields": [],
    "direction": "ltr",
    "expirationObj": {},
    "formCustomStyle": "",
    "formName": "CallVu Sales Enablement Quiz",
    "globalVariables": [],
    "hintMsgProps": {
      "text": "",
      "hideOnScroll": false
    },
    "isDownloadPDFLink": false,
    "isFormReadonly": false,
    "isPdfForm": false,
    "isSinglePage": false,
    "last_update": "",
    "logo": "",
    "logoAlignment": "center",
    "logoName": "",
    "logoUrl": "https://callvustudioproduction.s3.us-east-1.amazonaws.com/admin/callvu-icon-black.svg",
    "notResizable": true,
    "otp": {
      "buttonText": "",
      "description": "",
      "emptyFieldValidation": "",
      "invalidFieldValidation": "",
      "isActive": false,
      "label": "",
      "logo": "",
      "logoName": "",
      "resendText": "",
      "serviceUrl": "",
      "title": "",
      "validResponse": false,
      "validateUrl": false,
      "redirectAfterSubmit": false,
      "redirectLink": "",
      "isAuth": false,
      "optionalFields": []
    },
    "PDF": "",
    "permission": "client",
    "redirectAfterSubmit": false,
    "redirectLink": "",
    "stepperType": "Progress",
    "steps": [
      {
        "stepName": "Intro",
        "identifier": "step_intro",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": true,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Begin Quiz"
          },
          "targetStep": "step_rep_info",
          "isFirstNode": true
        },
        "blocks": [
          {
            "blockName": "",
            "identifier": "block_intro",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Intro",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Intro",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Welcome</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\">\n<p style=\"text-align: center; color: #4b5563; font-size: 16px; line-height: 1.6; max-width: 600px; margin: 0 auto;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">\nThis assessment will test your understanding of CallVu's Mode A and Mode B architecture.\n</p>\n<p style=\"margin-top: 24px; color: #6b7280; font-size: 14px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Instructions:</strong></p>\n<ul style=\"color: #4b5563; font-size: 14px; line-height: 1.8;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">\n  <li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Each question requires a voice response</li>\n  <li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Speak clearly and cover all key points</li>\n  <li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Your responses will be recorded and reviewed</li>\n  <li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">You can keep or delete your response to try again</li>\n</ul>\n<p style=\"margin-top: 16px; color: #9ca3af; font-size: 13px; font-style: italic;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Time estimate: 20-30 minutes</p>\n        </div></div>",
                    "localOnly": false
                  }
                ]
              }
            ],
            "style": {
              "alignment": "center",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Welcome",
        "isFirstStep": true,
        "isLastStep": false
      },
      {
        "stepName": "Rep Info",
        "identifier": "step_rep_info",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": true,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Continue"
          },
          "targetStep": "step_roleplay1",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Your Information",
            "identifier": "block_rep_info",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Rep_Info",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Rep_Info",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Your Information</h1></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "rep_name",
                    "integrationID": "RepName",
                    "isHiddenInRuntime": false,
                    "label": "Your Full Name",
                    "maskingViewer": "none",
                    "name": "editor.fields.shortText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "shortText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "rep_email",
                    "integrationID": "RepEmail",
                    "isHiddenInRuntime": false,
                    "label": "Email Address",
                    "maskingViewer": "none",
                    "name": "editor.fields.emailinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "emailInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "icon": "fa-envelope",
                    "localOnly": false
                  }
                ]
              }
            ],
            "style": {
              "alignment": "center",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Your Information",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Roleplay 1",
        "identifier": "step_roleplay1",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay2",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Roleplay 1",
            "identifier": "block_roleplay1",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Roleplay_1",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Roleplay_1",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Roleplay 1</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">A major bank tells you: \"Our card replacement process varies wildly depending on the agent. Some skip identity steps, others forget disclosures. Fraud loves this.\"</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">AE MUST:</strong> Provide your response using the voice recorder below.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Roleplay1_1764889332217",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Roleplay1'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Roleplay 1'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Roleplay1'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay1",
                    "integrationID": "Answer_Roleplay1",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 1",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Roleplay 2",
        "identifier": "step_roleplay2",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay3",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Roleplay 2",
            "identifier": "block_roleplay2",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Roleplay_2",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Roleplay_2",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Roleplay 2</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">A claims VP says: \"Our FNOL submissions are full of missing info and call center agents improvise the script.\"</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">AE MUST:</strong> Provide your response using the voice recorder below.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Roleplay2_1764889332221",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Roleplay2'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Roleplay 2'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Roleplay2'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay2",
                    "integrationID": "Answer_Roleplay2",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 2",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Roleplay 3",
        "identifier": "step_roleplay3",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay4",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Roleplay 3",
            "identifier": "block_roleplay3",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Roleplay_3",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Roleplay_3",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Roleplay 3</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">A telco sees a spike in fraudulent SIM swaps.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">AE MUST:</strong> Provide your response using the voice recorder below.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Roleplay3_1764889332221",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Roleplay3'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Roleplay 3'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Roleplay3'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay3",
                    "integrationID": "Answer_Roleplay3",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 3",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Roleplay 4",
        "identifier": "step_roleplay4",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay5",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Roleplay 4",
            "identifier": "block_roleplay4",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Roleplay_4",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Roleplay_4",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Roleplay 4</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Operations lead complains: \"Service activations are constantly wrong. Wrong dates, missing notices, and billing issues.\"</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">AE MUST:</strong> Provide your response using the voice recorder below.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Roleplay4_1764889332222",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Roleplay4'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Roleplay 4'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Roleplay4'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay4",
                    "integrationID": "Answer_Roleplay4",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 4",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Roleplay 5",
        "identifier": "step_roleplay5",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay6",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Roleplay 5",
            "identifier": "block_roleplay5",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Roleplay_5",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Roleplay_5",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Roleplay 5</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">A servicer says: \"Agents improvise hardship calls. Regulators are hammering us.\"</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">AE MUST:</strong> Provide your response using the voice recorder below.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Roleplay5_1764889332222",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Roleplay5'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Roleplay 5'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Roleplay5'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay5",
                    "integrationID": "Answer_Roleplay5",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 5",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Roleplay 6",
        "identifier": "step_roleplay6",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay7",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Roleplay 6",
            "identifier": "block_roleplay6",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Roleplay_6",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Roleplay_6",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Roleplay 6</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">A provider says: \"Intake data is wrong half the time. Insurance info missing. Consents aren't properly logged.\"</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">AE MUST:</strong> Provide your response using the voice recorder below.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Roleplay6_1764889332222",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Roleplay6'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Roleplay 6'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Roleplay6'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay6",
                    "integrationID": "Answer_Roleplay6",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 6",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Roleplay 7",
        "identifier": "step_roleplay7",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_drill_a",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Roleplay 7",
            "identifier": "block_roleplay7",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Roleplay_7",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Roleplay_7",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Roleplay 7</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">A CIO says: \"We have bots. Why do we need you?\"</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">AE MUST:</strong> Provide your response using the voice recorder below.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Roleplay7_1764889332223",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Roleplay7'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Roleplay 7'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Roleplay7'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay7",
                    "integrationID": "Answer_Roleplay7",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 7",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Drill A",
        "identifier": "step_drill_a",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_drill_b",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Drill A",
            "identifier": "block_drill_a",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Drill_A",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Drill_A",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Drill A</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">DRILL:</strong> Explain the CallVu architecture in 30 seconds.</p><p style=\"color: #4b5563; font-size: 15px; margin-top: 12px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">You must include:</strong></p><ul style=\"color: #4b5563; font-size: 15px; line-height: 1.8; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Micro-apps</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Orchestration</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Two modes</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Compliance</li></ul></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_DrillA_1764889332223",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'DrillA'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Drill A'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_DrillA'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_DrillA",
                    "integrationID": "Answer_DrillA",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Drill A",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Drill B",
        "identifier": "step_drill_b",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_drill_c",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Drill B",
            "identifier": "block_drill_b",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Drill_B",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Drill_B",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Drill B</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">DRILL:</strong> Explain why EACH of these statements is WRONG:</p><ol style=\"color: #4b5563; font-size: 15px; line-height: 1.8; margin-top: 12px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">\"CallVu is like a form builder.\"</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">\"Mode A is just self-service.\"</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">\"Mode B is basically RPA.\"</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">\"Bots + CallVu are interchangeable.\"</li></ol></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_DrillB_1764889332223",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'DrillB'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Drill B'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_DrillB'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_DrillB",
                    "integrationID": "Answer_DrillB",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Drill B",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Drill C",
        "identifier": "step_drill_c",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_exercise_a",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Drill C",
            "identifier": "block_drill_c",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Drill_C",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Drill_C",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Drill C</h1></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">DRILL:</strong> Select the correct answer.</p></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_MC_DrillC",
                    "integrationID": "MC_DrillC",
                    "isHiddenInRuntime": false,
                    "label": "What is the primary purpose of Mode A?",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. Backend automation",
                        "value": "A"
                      },
                      {
                        "label": "B. UI-led compliance and guided interactions",
                        "value": "B"
                      },
                      {
                        "label": "C. AI reasoning",
                        "value": "C"
                      },
                      {
                        "label": "D. Data storage",
                        "value": "D"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Drill C",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Exercise Set A",
        "identifier": "step_exercise_a",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_scenario1",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Exercise Set A: Mode Classification",
            "identifier": "block_exercise_a",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Exercise_Set_A",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Exercise_Set_A",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Exercise Set A</h1></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">EXERCISE:</strong> Classify each use case as Mode A only, Mode B only, or Mode A ‚Üí Mode B hybrid</p></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_1",
                    "integrationID": "Exercise_1",
                    "isHiddenInRuntime": false,
                    "label": "1. Customer updates their mailing address",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_2",
                    "integrationID": "Exercise_2",
                    "isHiddenInRuntime": false,
                    "label": "2. AI agent initiates a fee reversal",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_3",
                    "integrationID": "Exercise_3",
                    "isHiddenInRuntime": false,
                    "label": "3. Customer disputes a credit card transaction",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_4",
                    "integrationID": "Exercise_4",
                    "isHiddenInRuntime": false,
                    "label": "4. Mortgage escrow recalculation",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_5",
                    "integrationID": "Exercise_5",
                    "isHiddenInRuntime": false,
                    "label": "5. Patient intake form + insurance card upload",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Exercise Set A",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Scenario 1",
        "identifier": "step_scenario1",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_scenario2",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Scenario 1",
            "identifier": "block_scenario1",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Scenario_1",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Scenario_1",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Scenario 1</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">An agent accidentally skips a required disclosure step during a claims intake. Would this be possible in Mode A or Mode B?</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Scenario1_1764889332224",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Scenario1'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Scenario 1'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Scenario1'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Scenario1",
                    "integrationID": "Answer_Scenario1",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Scenario 1",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Scenario 2",
        "identifier": "step_scenario2",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_scenario3",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Scenario 2",
            "identifier": "block_scenario2",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Scenario_2",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Scenario_2",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Scenario 2</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">An AI agent decides to reorder steps in a workflow based on probability. Would CallVu allow this in Mode B?</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Scenario2_1764889332224",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Scenario2'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Scenario 2'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Scenario2'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Scenario2",
                    "integrationID": "Answer_Scenario2",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Scenario 2",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Scenario 3",
        "identifier": "step_scenario3",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_scenario4",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Scenario 3",
            "identifier": "block_scenario3",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Scenario_3",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Scenario_3",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Scenario 3</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">A customer submits an incomplete KYC step. What mode handles this? What happens?</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Scenario3_1764889332224",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Scenario3'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Scenario 3'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Scenario3'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Scenario3",
                    "integrationID": "Answer_Scenario3",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Scenario 3",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Scenario 4",
        "identifier": "step_scenario4",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_quiz1",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Scenario 4",
            "identifier": "block_scenario4",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Scenario_4",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Scenario_4",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Scenario 4</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Backend system fails mid-update. What does Mode B do?</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Scenario4_1764889332224",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Scenario4'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Scenario 4'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Scenario4'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Scenario4",
                    "integrationID": "Answer_Scenario4",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Scenario 4",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Quiz 1",
        "identifier": "step_quiz1",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_quiz2",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Quiz 1: Multiple Choice",
            "identifier": "block_quiz1",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Quiz_1",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Quiz_1",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Quiz 1</h1></div></div>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q1",
                    "integrationID": "Quiz1_Q1",
                    "isHiddenInRuntime": false,
                    "label": "1. Mode A enforces compliance through:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. LLM reasoning",
                        "value": "A"
                      },
                      {
                        "label": "B. UI interactions and micro-app constraints",
                        "value": "B"
                      },
                      {
                        "label": "C. Backend rules",
                        "value": "C"
                      },
                      {
                        "label": "D. Agent training",
                        "value": "D"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q2",
                    "integrationID": "Quiz1_Q2",
                    "isHiddenInRuntime": false,
                    "label": "2. Mode B exists because:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. Customers prefer automation",
                        "value": "A"
                      },
                      {
                        "label": "B. Backend execution must be deterministic and safe",
                        "value": "B"
                      },
                      {
                        "label": "C. It reduces UI load",
                        "value": "C"
                      },
                      {
                        "label": "D. It replaces CRM",
                        "value": "D"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q3",
                    "integrationID": "Quiz1_Q3",
                    "isHiddenInRuntime": false,
                    "label": "3. Micro-apps differ from forms because:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. They look nicer",
                        "value": "A"
                      },
                      {
                        "label": "B. They enforce logic, compliance, and backend calls",
                        "value": "B"
                      },
                      {
                        "label": "C. They store data in PDFs",
                        "value": "C"
                      },
                      {
                        "label": "D. They run only in digital channels",
                        "value": "D"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q4",
                    "integrationID": "Quiz1_Q4",
                    "isHiddenInRuntime": false,
                    "label": "4. MCP enables:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. AI to rewrite business rules",
                        "value": "A"
                      },
                      {
                        "label": "B. AI to safely trigger Mode A or Mode B flows",
                        "value": "B"
                      },
                      {
                        "label": "C. Voice recognition",
                        "value": "C"
                      },
                      {
                        "label": "D. Payment processing",
                        "value": "D"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q5",
                    "integrationID": "Quiz1_Q5",
                    "isHiddenInRuntime": false,
                    "label": "5. In regulated industries, the biggest risk is:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. UI design",
                        "value": "A"
                      },
                      {
                        "label": "B. Customers forgetting their passwords",
                        "value": "B"
                      },
                      {
                        "label": "C. Agents deviating from required steps",
                        "value": "C"
                      },
                      {
                        "label": "D. Unpopular branding",
                        "value": "D"
                      }
                    ],
                    "localOnly": false
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Quiz 1",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Quiz 2",
        "identifier": "step_quiz2",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_check1",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Quiz 2",
            "identifier": "block_quiz2",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Quiz_2",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Quiz_2",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Quiz 2</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">QUIZ:</strong> Explain CallVu in 20 seconds.</p><p style=\"color: #4b5563; font-size: 15px; margin-top: 12px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Your answer should include:</strong></p><ul style=\"color: #4b5563; font-size: 15px; line-height: 1.8; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Completion & compliance layer</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Micro-apps</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Mode A + Mode B</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Works across channels</li><li style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;max-width:100%!important;box-sizing:border-box!important;\">Not a bot</li></ul></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Quiz2_1764889332224",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Quiz2'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Quiz 2'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Quiz2'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Quiz2",
                    "integrationID": "Answer_Quiz2",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Quiz 2",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Check 1",
        "identifier": "step_check1",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_check2",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Check 1",
            "identifier": "block_check1",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Check_1",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Check_1",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Check 1</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">CHECK 1:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Explain Mode A in two sentences.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Check1_1764889332224",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Check1'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Check 1'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Check1'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Check1",
                    "integrationID": "Answer_Check1",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Check 1",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Check 2",
        "identifier": "step_check2",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_check3",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Check 2",
            "identifier": "block_check2",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Check_2",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Check_2",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Check 2</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">CHECK 2:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Explain Mode B in two sentences.</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Check2_1764889332225",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Check2'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Check 2'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Check2'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Check2",
                    "integrationID": "Answer_Check2",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Check 2",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Check 3",
        "identifier": "step_check3",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_check4",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Check 3",
            "identifier": "block_check3",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Check_3",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Check_3",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Check 3</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">CHECK 3:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Why can't bots replace CallVu?</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Check3_1764889332225",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Check3'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Check 3'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Check3'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Check3",
                    "integrationID": "Answer_Check3",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Check 3",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Check 4",
        "identifier": "step_check4",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Submit Quiz"
          },
          "targetStep": "step_complete",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "Check 4",
            "identifier": "block_check4",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading_Check_4",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Sales Enablement Quiz - Mode A and B</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading_Check_4",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Check 4</h1></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\"><p style=\"color: #374151; font-size: 15px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\"><strong style=\"color: #1f2937;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">CHECK 4:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">What layer contains the deterministic execution engine?</p></div></div>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "voice_recorder_Check4_1764889332225",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\r\n\r\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\r\n  <div style=\"margin-bottom: 15px;\">\r\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\r\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\r\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"text-align: center; margin-bottom: 15px;\">\r\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\r\n      ‚è∫\r\n    </button>\r\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\r\n  </div>\r\n  \r\n  \r\n  <div style=\"margin-bottom: 15px;\">\r\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\r\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\r\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\r\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\r\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\r\n  </div>\r\n  \r\n  \r\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\r\n    ‚úì Response saved! You can proceed to the next question.\r\n  </div>\r\n  \r\n  \r\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\r\n</div>\r\n\r\n<script>\r\n(function() {\r\n  'use strict';\r\n  \r\n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\r\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\r\n  const QUESTION_ID = 'Check4'; // Will be replaced by CallVu\r\n  const QUESTION_TITLE = 'Check 4'; // Will be replaced by CallVu\r\n  const ANSWER_FIELD_ID = 'Answer_Check4'; // Will be replaced by CallVu\r\n  \r\n  // State\r\n  let recognition = null;\r\n  let isRecording = false;\r\n  let transcript = '';\r\n  let startTime = 0;\r\n  let timerInterval = null;\r\n  let repName = '';\r\n  let repEmail = '';\r\n  \r\n  // Initialize\r\n  function init() {\r\n    // Check browser support\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\r\n      document.getElementById('record-btn').disabled = true;\r\n      return;\r\n    }\r\n    \r\n    // Initialize speech recognition\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = 'en-US';\r\n    \r\n    recognition.onresult = function(event) {\r\n      let interim = '';\r\n      let final = '';\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          final += result[0].transcript + ' ';\r\n        } else {\r\n          interim += result[0].transcript;\r\n        }\r\n      }\r\n      \r\n      if (final) {\r\n        transcript += final;\r\n        updateTranscript();\r\n      }\r\n      \r\n      if (interim) {\r\n        updateTranscript(interim);\r\n      }\r\n    };\r\n    \r\n    recognition.onerror = function(event) {\r\n      if (event.error === 'not-allowed') {\r\n        showError('Microphone access denied. Please enable microphone permissions.');\r\n      } else if (event.error !== 'no-speech') {\r\n        showError('Recognition error: ' + event.error);\r\n      }\r\n    };\r\n    \r\n    recognition.onend = function() {\r\n      if (isRecording) {\r\n        try {\r\n          recognition.start();\r\n        } catch (e) {\r\n          // Ignore\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Get user info from CallVu form\r\n    setTimeout(getUserInfo, 1000);\r\n  }\r\n  \r\n  function getUserInfo() {\r\n    // Try to find name and email fields\r\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\r\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\r\n    \r\n    if (nameField) repName = nameField.value || '';\r\n    if (emailField) repEmail = emailField.value || '';\r\n    \r\n    // Listen for changes\r\n    if (nameField) {\r\n      nameField.addEventListener('input', function() { repName = this.value; });\r\n    }\r\n    if (emailField) {\r\n      emailField.addEventListener('input', function() { repEmail = this.value; });\r\n    }\r\n  }\r\n  \r\n  function toggleRecording() {\r\n    if (!isRecording) {\r\n      startRecording();\r\n    } else {\r\n      stopRecording();\r\n    }\r\n  }\r\n  \r\n  async function startRecording() {\r\n    try {\r\n      await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      \r\n      transcript = '';\r\n      startTime = Date.now();\r\n      isRecording = true;\r\n      \r\n      recognition.start();\r\n      \r\n      document.getElementById('record-btn').style.background = '#ef4444';\r\n      document.getElementById('record-btn').innerHTML = '‚èπ';\r\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\r\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\r\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\r\n      document.getElementById('status-display').style.background = '#fee2e2';\r\n      document.getElementById('action-buttons').style.display = 'none';\r\n      document.getElementById('success-message').style.display = 'none';\r\n      hideError();\r\n      \r\n      startTimer();\r\n    } catch (err) {\r\n      showError('Could not access microphone. Please allow microphone permissions.');\r\n    }\r\n  }\r\n  \r\n  function stopRecording() {\r\n    isRecording = false;\r\n    recognition.stop();\r\n    clearInterval(timerInterval);\r\n    \r\n    document.getElementById('record-btn').style.background = '#3b82f6';\r\n    document.getElementById('record-btn').innerHTML = '‚è∫';\r\n    document.getElementById('record-btn').style.animation = 'none';\r\n    document.getElementById('record-hint').textContent = 'Click to record again';\r\n    document.getElementById('status-text').textContent = 'Stopped recording';\r\n    document.getElementById('status-display').style.background = '#fef3c7';\r\n    \r\n    if (transcript.trim()) {\r\n      document.getElementById('action-buttons').style.display = 'flex';\r\n    }\r\n  }\r\n  \r\n  function startTimer() {\r\n    timerInterval = setInterval(function() {\r\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\r\n      const mins = Math.floor(elapsed / 60);\r\n      const secs = elapsed % 60;\r\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\r\n      document.getElementById('timer').style.color = '#ef4444';\r\n    }, 1000);\r\n  }\r\n  \r\n  function updateTranscript(interim) {\r\n    const display = document.getElementById('transcript-display');\r\n    display.value = transcript;\r\n    if (interim) {\r\n      display.value += ' ' + interim;\r\n    }\r\n    \r\n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\r\n    document.getElementById('word-count').textContent = wordCount + ' words';\r\n    \r\n    // Update CallVu field if it exists\r\n    updateCallVuField();\r\n  }\r\n  \r\n  function updateCallVuField() {\r\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\r\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\r\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\r\n      if (field) {\r\n        field.value = transcript;\r\n        field.dispatchEvent(new Event('input', { bubbles: true }));\r\n        field.dispatchEvent(new Event('change', { bubbles: true }));\r\n      }\r\n    }\r\n  }\r\n  \r\n  function keepResponse() {\r\n    if (!transcript.trim()) {\r\n      showError('No response to keep. Please record your answer first.');\r\n      return;\r\n    }\r\n    \r\n    updateCallVuField();\r\n    logToSpreadsheet();\r\n    enableNextButton();\r\n    \r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'block';\r\n    document.getElementById('transcript-display').style.background = '#d1fae5';\r\n  }\r\n  \r\n  function deleteResponse() {\r\n    transcript = '';\r\n    document.getElementById('transcript-display').value = '';\r\n    document.getElementById('word-count').textContent = '0 words';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n    document.getElementById('success-message').style.display = 'none';\r\n    document.getElementById('transcript-display').style.background = 'white';\r\n    document.getElementById('timer').textContent = '0:00';\r\n    document.getElementById('timer').style.color = '#6b7280';\r\n    \r\n    updateCallVuField();\r\n    disableNextButton();\r\n  }\r\n  \r\n  function enableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n      nextButton.classList.remove('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  function disableNextButton() {\r\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\r\n    if (nextButton) {\r\n      nextButton.disabled = true;\r\n      nextButton.classList.add('disabled', 'opacity-50');\r\n    }\r\n  }\r\n  \r\n  async function logToSpreadsheet() {\r\n    if (!repName.trim() || !repEmail.trim()) {\r\n      console.warn('Missing name/email for spreadsheet logging');\r\n      return;\r\n    }\r\n    \r\n    const duration = Math.floor((Date.now() - startTime) / 1000);\r\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\r\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\r\n    \r\n    const payload = {\r\n      timestamp: new Date().toISOString(),\r\n      repName: repName.trim(),\r\n      repEmail: repEmail.trim(),\r\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\r\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\r\n      transcript: transcript.trim(),\r\n      recordingDuration: duration,\r\n      responseType: 'Voice'\r\n    };\r\n    \r\n    try {\r\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\r\n        await fetch(SHEET_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          mode: 'no-cors',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload)\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log('Webhook error:', err);\r\n    }\r\n  }\r\n  \r\n  function showError(message) {\r\n    const errorDiv = document.getElementById('error-message');\r\n    errorDiv.textContent = message;\r\n    errorDiv.style.display = 'block';\r\n  }\r\n  \r\n  function hideError() {\r\n    document.getElementById('error-message').style.display = 'none';\r\n  }\r\n  \r\n  // Add pulse animation\r\n  const style = document.createElement('style');\r\n  style.textContent = `\r\n    @keyframes pulse {\r\n      0%, 100% { opacity: 1; }\r\n      50% { opacity: 0.7; }\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n  \r\n  // Initialize when page loads\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n})();\r\n</script>\r\n\r\n",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Check4",
                    "integrationID": "Answer_Check4",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": true,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000,
                    "localOnly": false
                  }
                ],
                "hasVoiceRecorder": true
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Check 4",
        "isLastStep": false,
        "isFirstStep": false
      },
      {
        "stepName": "Complete",
        "identifier": "step_complete",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": true,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": true,
            "text": ""
          },
          "targetStep": "",
          "isFirstNode": false
        },
        "blocks": [
          {
            "blockName": "",
            "identifier": "block_complete",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<div class=\"mobile-wrap-container\" style=\"word-wrap:break-word!important;overflow-wrap:break-word!important;word-break:break-word!important;hyphens:auto!important;max-width:100%!important;width:100%!important;box-sizing:border-box!important;padding:0 5px!important;\"><div style=\"word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; max-width: 100%;\">\n<h2 style=\"text-align: center; color: #1f2937; font-size: 28px; font-weight: 700; margin-bottom: 16px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">üéâ Quiz Complete!</h2>\n<p style=\"text-align: center; color: #4b5563; font-size: 16px; line-height: 1.6;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Thank you for completing the CallVu Sales Enablement Quiz.</p>\n<p style=\"text-align: center; color: #6b7280; font-size: 14px; margin-top: 8px;;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto;max-width:100%;box-sizing:border-box;\">Your responses have been recorded and will be reviewed.</p>\n      </div></div>",
                    "localOnly": false
                  }
                ]
              }
            ],
            "style": {
              "alignment": "center",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": true,
        "text": "Complete",
        "isLastStep": true,
        "isFirstStep": false
      }
    ],
    "templateType": 3,
    "thankYouPageMarkup": "",
    "theme": {
      "primary": "hsl(210, 100%, 45%)",
      "title": "#1c1c1c",
      "text": "#3b3b3b",
      "background": "hsl(0, 0%, 100%)",
      "blockBackground": "#ffffff",
      "headerText": "#1c1c1c",
      "font": "Inter-Regular",
      "headerBackground": "#ffffff",
      "secondary": "hsl(210, 80%, 95%)",
      "warning": "hsl(40, 97%, 47%)",
      "altBackground": "hsl(0, 0%, 97%)",
      "danger": "hsl(14, 80%, 50%)",
      "link": "hsl(209, 81%, 52%)",
      "success": "hsl(145, 94%, 32%)",
      "dark": "hsl(0, 0%, 29%)",
      "bright": "hsl(54, 100%, 81%)",
      "neutral": "hsl(124, 37%, 84%)"
    },
    "title": "Sales Enablement Quiz",
    "privateMode": false,
    "otpTemplateID": "",
    "isOTPEnabled": false,
    "otpVersion": 2,
    "formVersion": "10.4.40",
    "lastModified": "",
    "newRules": [],
    "Timestamp": "",
    "TimeModified": "",
    "style": "",
    "formCSS": {
      "ID": "",
      "Name": "",
      "Description": "",
      "CSS": ""
    },
    "id": null,
    "backgroundUrl": {
      "desktop": "",
      "mobile": ""
    }
  }
}