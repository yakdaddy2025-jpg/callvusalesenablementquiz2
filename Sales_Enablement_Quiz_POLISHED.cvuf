{
  "form": {
    "accessibility": false,
    "actions": [],
    "approveData": {
      "enabled": false,
      "forceApproveBeforeShowingDownload": false,
      "toCloseForm": false,
      "popupObj": {
        "errorMsg": "",
        "fieldType": "",
        "message": "",
        "title": ""
      },
      "submitIcon": ""
    },
    "calculatedFields": [],
    "direction": "ltr",
    "expirationObj": {},
    "formCustomStyle": "<style>textarea[data-integration-id^=Answer_]{pointer-events:none;background-color:#f9fafb;cursor:not-allowed}button.disabled,button[disabled]{opacity:0.5;cursor:not-allowed}p,div,span{word-wrap:break-word;overflow-wrap:break-word}@media (max-width:768px){p{font-size:14px!important;line-height:1.6!important;word-wrap:break-word;overflow-wrap:break-word;max-width:100%!important}}</style>",
    "formName": "CallVu Sales Enablement Quiz",
    "globalVariables": [],
    "hintMsgProps": {
      "text": "",
      "hideOnScroll": false
    },
    "isDownloadPDFLink": false,
    "isFormReadonly": false,
    "isPdfForm": false,
    "isSinglePage": false,
    "last_update": "",
    "logo": "",
    "logoAlignment": "center",
    "logoName": "",
    "logoUrl": "https://callvustudioproduction.s3.us-east-1.amazonaws.com/admin/callvu-icon-black.svg",
    "notResizable": true,
    "otp": {
      "buttonText": "",
      "description": "",
      "emptyFieldValidation": "",
      "invalidFieldValidation": "",
      "isActive": false,
      "label": "",
      "logo": "",
      "logoName": "",
      "resendText": "",
      "serviceUrl": "",
      "title": "",
      "validResponse": false,
      "validateUrl": false,
      "redirectAfterSubmit": false,
      "redirectLink": "",
      "isAuth": false,
      "optionalFields": []
    },
    "PDF": "",
    "permission": "client",
    "redirectAfterSubmit": false,
    "redirectLink": "",
    "stepperType": "Progress",
    "steps": [
      {
        "stepName": "Intro",
        "identifier": "step_intro",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": true,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Begin Quiz"
          },
          "targetStep": "step_rep_info",
          "isFirstNode": true
        },
        "blocks": [
          {
            "blockName": "",
            "identifier": "block_intro",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Welcome</h1>",
                    "localOnly": false
                  },
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\n<p style=\"text-align: center; color: #4b5563; font-size: 16px; line-height: 1.6; max-width: 600px; margin: 0 auto;\">\nThis assessment will test your understanding of CallVu's Mode A and Mode B architecture.\n</p>\n<p style=\"margin-top: 24px; color: #6b7280; font-size: 14px;\"><strong>Instructions:</strong></p>\n<ul style=\"color: #4b5563; font-size: 14px; line-height: 1.8;\">\n  <li>Each question requires a voice response</li>\n  <li>Speak clearly and cover all key points</li>\n  <li>Your responses will be recorded and reviewed</li>\n  <li>You can keep or delete your response to try again</li>\n</ul>\n<p style=\"margin-top: 16px; color: #9ca3af; font-size: 13px; font-style: italic;\">Time estimate: 20-30 minutes</p>\n        ",
                    "localOnly": false
                  }
                ]
              }
            ],
            "style": {
              "alignment": "center",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Intro",
        "isFirstStep": true,
        "isLastStep": false
      },
      {
        "stepName": "Rep Info",
        "identifier": "step_rep_info",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": true,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Continue"
          },
          "targetStep": "step_roleplay1"
        },
        "blocks": [
          {
            "blockName": "Your Information",
            "identifier": "block_rep_info",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Your Information</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "rep_name",
                    "integrationID": "RepName",
                    "isHiddenInRuntime": false,
                    "label": "Your Full Name",
                    "maskingViewer": "none",
                    "name": "editor.fields.shortText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "shortText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "rep_email",
                    "integrationID": "RepEmail",
                    "isHiddenInRuntime": false,
                    "label": "Email Address",
                    "maskingViewer": "none",
                    "name": "editor.fields.emailinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "emailInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "icon": "fa-envelope"
                  }
                ]
              }
            ],
            "style": {
              "alignment": "center",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Rep Info",
        "isLastStep": false
      },
      {
        "stepName": "Roleplay 1",
        "identifier": "step_roleplay1",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay2"
        },
        "blocks": [
          {
            "blockName": "Roleplay 1",
            "identifier": "block_roleplay1",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Roleplay 1</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">A major bank tells you: \"Our card replacement process varies wildly depending on the agent. Some skip identity steps, others forget disclosures. Fraud loves this.\"</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;\"><strong style=\"color: #1f2937;\">YOUR TASK:</strong> Provide your response using the voice recorder below.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Roleplay1'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Roleplay 1'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Roleplay1'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay1",
                    "integrationID": "Answer_Roleplay1",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 1",
        "isLastStep": false
      },
      {
        "stepName": "Roleplay 2",
        "identifier": "step_roleplay2",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay3"
        },
        "blocks": [
          {
            "blockName": "Roleplay 2",
            "identifier": "block_roleplay2",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Roleplay 2</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">A claims VP says: \"Our FNOL submissions are full of missing info and call center agents improvise the script.\"</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129194",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;\"><strong style=\"color: #1f2937;\">YOUR TASK:</strong> Provide your response using the voice recorder below.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Roleplay2'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Roleplay 2'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Roleplay2'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay2",
                    "integrationID": "Answer_Roleplay2",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 2",
        "isLastStep": false
      },
      {
        "stepName": "Roleplay 3",
        "identifier": "step_roleplay3",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay4"
        },
        "blocks": [
          {
            "blockName": "Roleplay 3",
            "identifier": "block_roleplay3",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Roleplay 3</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">A telco sees a spike in fraudulent SIM swaps.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;\"><strong style=\"color: #1f2937;\">YOUR TASK:</strong> Provide your response using the voice recorder below.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Roleplay3'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Roleplay 3'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Roleplay3'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay3",
                    "integrationID": "Answer_Roleplay3",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 3",
        "isLastStep": false
      },
      {
        "stepName": "Roleplay 4",
        "identifier": "step_roleplay4",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay5"
        },
        "blocks": [
          {
            "blockName": "Roleplay 4",
            "identifier": "block_roleplay4",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Roleplay 4</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">Operations lead complains: \"Service activations are constantly wrong. Wrong dates, missing notices, and billing issues.\"</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;\"><strong style=\"color: #1f2937;\">YOUR TASK:</strong> Provide your response using the voice recorder below.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Roleplay4'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Roleplay 4'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Roleplay4'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay4",
                    "integrationID": "Answer_Roleplay4",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 4",
        "isLastStep": false
      },
      {
        "stepName": "Roleplay 5",
        "identifier": "step_roleplay5",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay6"
        },
        "blocks": [
          {
            "blockName": "Roleplay 5",
            "identifier": "block_roleplay5",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Roleplay 5</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">A servicer says: \"Agents improvise hardship calls. Regulators are hammering us.\"</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;\"><strong style=\"color: #1f2937;\">YOUR TASK:</strong> Provide your response using the voice recorder below.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Roleplay5'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Roleplay 5'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Roleplay5'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay5",
                    "integrationID": "Answer_Roleplay5",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 5",
        "isLastStep": false
      },
      {
        "stepName": "Roleplay 6",
        "identifier": "step_roleplay6",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_roleplay7"
        },
        "blocks": [
          {
            "blockName": "Roleplay 6",
            "identifier": "block_roleplay6",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Roleplay 6</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">A provider says: \"Intake data is wrong half the time. Insurance info missing. Consents aren't properly logged.\"</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;\"><strong style=\"color: #1f2937;\">YOUR TASK:</strong> Provide your response using the voice recorder below.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Roleplay6'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Roleplay 6'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Roleplay6'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay6",
                    "integrationID": "Answer_Roleplay6",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 6",
        "isLastStep": false
      },
      {
        "stepName": "Roleplay 7",
        "identifier": "step_roleplay7",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_drill_a"
        },
        "blocks": [
          {
            "blockName": "Roleplay 7",
            "identifier": "block_roleplay7",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Roleplay 7</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">A CIO says: \"We have bots. Why do we need you?\"</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129195",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6; margin-top: 16px;\"><strong style=\"color: #1f2937;\">YOUR TASK:</strong> Provide your response using the voice recorder below.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Roleplay7'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Roleplay 7'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Roleplay7'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Roleplay7",
                    "integrationID": "Answer_Roleplay7",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Roleplay 7",
        "isLastStep": false
      },
      {
        "stepName": "Drill A",
        "identifier": "step_drill_a",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_drill_b"
        },
        "blocks": [
          {
            "blockName": "Drill A",
            "identifier": "block_drill_a",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Drill A</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">DRILL:</strong> Explain the CallVu architecture in 30 seconds.</p><p style=\"color: #4b5563; font-size: 15px; margin-top: 12px;\"><strong>You must include:</strong></p><ul style=\"color: #4b5563; font-size: 15px; line-height: 1.8; margin-top: 8px;\"><li>Micro-apps</li><li>Orchestration</li><li>Two modes</li><li>Compliance</li></ul>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'DrillA'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Drill A: Architecture Explanation'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_DrillA'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_DrillA",
                    "integrationID": "Answer_DrillA",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Drill A",
        "isLastStep": false
      },
      {
        "stepName": "Drill B",
        "identifier": "step_drill_b",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_drill_c"
        },
        "blocks": [
          {
            "blockName": "Drill B",
            "identifier": "block_drill_b",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Drill B</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">DRILL:</strong> Explain why EACH of these statements is WRONG:</p><ol style=\"color: #4b5563; font-size: 15px; line-height: 1.8; margin-top: 12px;\"><li>\"CallVu is like a form builder.\"</li><li>\"Mode A is just self-service.\"</li><li>\"Mode B is basically RPA.\"</li><li>\"Bots + CallVu are interchangeable.\"</li></ol>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'DrillB'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Drill B: Spot Wrong Analogies'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_DrillB'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_DrillB",
                    "integrationID": "Answer_DrillB",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Drill B",
        "isLastStep": false
      },
      {
        "stepName": "Drill C",
        "identifier": "step_drill_c",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_exercise_a"
        },
        "blocks": [
          {
            "blockName": "Drill C",
            "identifier": "block_drill_c",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Drill C</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">DRILL:</strong> Select the correct answer.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_MC_DrillC",
                    "integrationID": "MC_DrillC",
                    "isHiddenInRuntime": false,
                    "label": "What is the primary purpose of Mode A?",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. Backend automation",
                        "value": "A"
                      },
                      {
                        "label": "B. UI-led compliance and guided interactions",
                        "value": "B"
                      },
                      {
                        "label": "C. AI reasoning",
                        "value": "C"
                      },
                      {
                        "label": "D. Data storage",
                        "value": "D"
                      }
                    ]
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Drill C",
        "isLastStep": false
      },
      {
        "stepName": "Exercise Set A",
        "identifier": "step_exercise_a",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_scenario1"
        },
        "blocks": [
          {
            "blockName": "Exercise Set A: Mode Classification",
            "identifier": "block_exercise_a",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Exercise Set A</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">EXERCISE:</strong> Classify each use case as Mode A only, Mode B only, or Mode A ‚Üí Mode B hybrid</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_1",
                    "integrationID": "Exercise_1",
                    "isHiddenInRuntime": false,
                    "label": "1. Customer updates their mailing address",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ]
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_2",
                    "integrationID": "Exercise_2",
                    "isHiddenInRuntime": false,
                    "label": "2. AI agent initiates a fee reversal",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ]
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_3",
                    "integrationID": "Exercise_3",
                    "isHiddenInRuntime": false,
                    "label": "3. Customer disputes a credit card transaction",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ]
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_4",
                    "integrationID": "Exercise_4",
                    "isHiddenInRuntime": false,
                    "label": "4. Mortgage escrow recalculation",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ]
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Exercise_5",
                    "integrationID": "Exercise_5",
                    "isHiddenInRuntime": false,
                    "label": "5. Patient intake form + insurance card upload",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "Mode A only",
                        "value": "Mode A"
                      },
                      {
                        "label": "Mode B only",
                        "value": "Mode B"
                      },
                      {
                        "label": "Mode A ‚Üí Mode B",
                        "value": "Hybrid"
                      }
                    ]
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Exercise Set A",
        "isLastStep": false
      },
      {
        "stepName": "Scenario 1",
        "identifier": "step_scenario1",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_scenario2"
        },
        "blocks": [
          {
            "blockName": "Scenario 1",
            "identifier": "block_scenario1",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Scenario 1</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">An agent accidentally skips a required disclosure step during a claims intake. Would this be possible in Mode A or Mode B?</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Scenario1'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Scenario 1'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Scenario1'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Scenario1",
                    "integrationID": "Answer_Scenario1",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Scenario 1",
        "isLastStep": false
      },
      {
        "stepName": "Scenario 2",
        "identifier": "step_scenario2",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_scenario3"
        },
        "blocks": [
          {
            "blockName": "Scenario 2",
            "identifier": "block_scenario2",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Scenario 2</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">An AI agent decides to reorder steps in a workflow based on probability. Would CallVu allow this in Mode B?</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Scenario2'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Scenario 2'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Scenario2'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Scenario2",
                    "integrationID": "Answer_Scenario2",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Scenario 2",
        "isLastStep": false
      },
      {
        "stepName": "Scenario 3",
        "identifier": "step_scenario3",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_scenario4"
        },
        "blocks": [
          {
            "blockName": "Scenario 3",
            "identifier": "block_scenario3",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Scenario 3</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">A customer submits an incomplete KYC step. What mode handles this? What happens?</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Scenario3'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Scenario 3'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Scenario3'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Scenario3",
                    "integrationID": "Answer_Scenario3",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Scenario 3",
        "isLastStep": false
      },
      {
        "stepName": "Scenario 4",
        "identifier": "step_scenario4",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_quiz1"
        },
        "blocks": [
          {
            "blockName": "Scenario 4",
            "identifier": "block_scenario4",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Scenario 4</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129196",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">SCENARIO:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">Backend system fails mid-update. What does Mode B do?</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Scenario4'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Scenario 4'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Scenario4'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Scenario4",
                    "integrationID": "Answer_Scenario4",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Scenario 4",
        "isLastStep": false
      },
      {
        "stepName": "Quiz 1",
        "identifier": "step_quiz1",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_quiz2"
        },
        "blocks": [
          {
            "blockName": "Quiz 1: Multiple Choice",
            "identifier": "block_quiz1",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Quiz 1</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q1",
                    "integrationID": "Quiz1_Q1",
                    "isHiddenInRuntime": false,
                    "label": "1. Mode A enforces compliance through:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. LLM reasoning",
                        "value": "A"
                      },
                      {
                        "label": "B. UI interactions and micro-app constraints",
                        "value": "B"
                      },
                      {
                        "label": "C. Backend rules",
                        "value": "C"
                      },
                      {
                        "label": "D. Agent training",
                        "value": "D"
                      }
                    ]
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q2",
                    "integrationID": "Quiz1_Q2",
                    "isHiddenInRuntime": false,
                    "label": "2. Mode B exists because:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. Customers prefer automation",
                        "value": "A"
                      },
                      {
                        "label": "B. Backend execution must be deterministic and safe",
                        "value": "B"
                      },
                      {
                        "label": "C. It reduces UI load",
                        "value": "C"
                      },
                      {
                        "label": "D. It replaces CRM",
                        "value": "D"
                      }
                    ]
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q3",
                    "integrationID": "Quiz1_Q3",
                    "isHiddenInRuntime": false,
                    "label": "3. Micro-apps differ from forms because:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. They look nicer",
                        "value": "A"
                      },
                      {
                        "label": "B. They enforce logic, compliance, and backend calls",
                        "value": "B"
                      },
                      {
                        "label": "C. They store data in PDFs",
                        "value": "C"
                      },
                      {
                        "label": "D. They run only in digital channels",
                        "value": "D"
                      }
                    ]
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q4",
                    "integrationID": "Quiz1_Q4",
                    "isHiddenInRuntime": false,
                    "label": "4. MCP enables:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. AI to rewrite business rules",
                        "value": "A"
                      },
                      {
                        "label": "B. AI to safely trigger Mode A or Mode B flows",
                        "value": "B"
                      },
                      {
                        "label": "C. Voice recognition",
                        "value": "C"
                      },
                      {
                        "label": "D. Payment processing",
                        "value": "D"
                      }
                    ]
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "mc_Quiz1_Q5",
                    "integrationID": "Quiz1_Q5",
                    "isHiddenInRuntime": false,
                    "label": "5. In regulated industries, the biggest risk is:",
                    "maskingViewer": "none",
                    "name": "editor.fields.radioinput",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "radioInput",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "items": [
                      {
                        "label": "A. UI design",
                        "value": "A"
                      },
                      {
                        "label": "B. Customers forgetting their passwords",
                        "value": "B"
                      },
                      {
                        "label": "C. Agents deviating from required steps",
                        "value": "C"
                      },
                      {
                        "label": "D. Unpopular branding",
                        "value": "D"
                      }
                    ]
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Quiz 1",
        "isLastStep": false
      },
      {
        "stepName": "Quiz 2",
        "identifier": "step_quiz2",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_check1"
        },
        "blocks": [
          {
            "blockName": "Quiz 2",
            "identifier": "block_quiz2",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Quiz 2</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">QUIZ:</strong> Explain CallVu in 20 seconds.</p><p style=\"color: #4b5563; font-size: 15px; margin-top: 12px;\"><strong>Your answer should include:</strong></p><ul style=\"color: #4b5563; font-size: 15px; line-height: 1.8; margin-top: 8px;\"><li>Completion & compliance layer</li><li>Micro-apps</li><li>Mode A + Mode B</li><li>Works across channels</li><li>Not a bot</li></ul>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Quiz2'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Quiz 2: 20-Second Pitch'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Quiz2'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Quiz2",
                    "integrationID": "Answer_Quiz2",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Quiz 2",
        "isLastStep": false
      },
      {
        "stepName": "Check 1",
        "identifier": "step_check1",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_check2"
        },
        "blocks": [
          {
            "blockName": "Check 1",
            "identifier": "block_check1",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Check 1</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">CHECK 1:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">Explain Mode A in two sentences.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Check1'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Check 1'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Check1'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Check1",
                    "integrationID": "Answer_Check1",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Check 1",
        "isLastStep": false
      },
      {
        "stepName": "Check 2",
        "identifier": "step_check2",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_check3"
        },
        "blocks": [
          {
            "blockName": "Check 2",
            "identifier": "block_check2",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Check 2</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">CHECK 2:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">Explain Mode B in two sentences.</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Check2'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Check 2'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Check2'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Check2",
                    "integrationID": "Answer_Check2",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Check 2",
        "isLastStep": false
      },
      {
        "stepName": "Check 3",
        "identifier": "step_check3",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Next"
          },
          "targetStep": "step_check4"
        },
        "blocks": [
          {
            "blockName": "Check 3",
            "identifier": "block_check3",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Check 3</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">CHECK 3:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">Why can't bots replace CallVu?</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Check3'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Check 3'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Check3'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Check3",
                    "integrationID": "Answer_Check3",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Check 3",
        "isLastStep": false
      },
      {
        "stepName": "Check 4",
        "identifier": "step_check4",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": false,
            "text": ""
          },
          "next": {
            "className": "disabled",
            "isHidden": false,
            "text": "Submit Quiz"
          },
          "targetStep": "step_complete"
        },
        "blocks": [
          {
            "blockName": "Check 4",
            "identifier": "block_check4",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "small_heading",
                    "integrationID": "SmallHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"text-align: center; color: #6b7280; font-size: 14px; font-weight: 500; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Sales Enablement Quiz - Mode A and B</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "large_heading",
                    "integrationID": "LargeHeading",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<h1 style=\"text-align: center; color: #1f2937; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; line-height: 1.2;\">Check 4</h1>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<p style=\"color: #374151; font-size: 15px; line-height: 1.6;\"><strong style=\"color: #1f2937;\">CHECK 4:</strong></p><p style=\"color: #4b5563; font-size: 15px; line-height: 1.7; margin-top: 8px;\">What layer contains the deterministic execution engine?</p>",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "<!--\nInline Voice Recorder - Embed this directly in CallVu paragraph fields\nNo Vercel needed! Uses browser's built-in Web Speech API\n-->\n\n<div id=\"voice-recorder-container\" style=\"margin: 20px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; background: #f9fafb;\">\n  <div style=\"margin-bottom: 15px;\">\n    <h3 style=\"margin: 0 0 10px 0; color: #1f2937; font-size: 18px;\">üé§ Voice Response Recorder</h3>\n    <p style=\"margin: 0; color: #6b7280; font-size: 14px;\">Click record and speak your answer. Voice input only - typing is disabled.</p>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"status-display\" style=\"margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; min-height: 40px; display: flex; align-items: center; justify-content: center;\">\n    <span id=\"status-text\" style=\"color: #6b7280;\">Ready to record</span>\n  </div>\n  \n  <!-- Timer -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <div id=\"timer\" style=\"font-size: 32px; font-weight: bold; color: #6b7280; font-family: monospace;\">0:00</div>\n  </div>\n  \n  <!-- Record Button -->\n  <div style=\"text-align: center; margin-bottom: 15px;\">\n    <button id=\"record-btn\" onclick=\"toggleRecording()\" style=\"width: 80px; height: 80px; border-radius: 50%; border: none; background: #3b82f6; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;\">\n      ‚è∫\n    </button>\n    <p id=\"record-hint\" style=\"margin-top: 10px; color: #6b7280; font-size: 14px;\">Click to start recording</p>\n  </div>\n  \n  <!-- Transcript Display -->\n  <div style=\"margin-bottom: 15px;\">\n    <label style=\"display: block; margin-bottom: 8px; font-weight: 600; color: #374151;\">Your Response (Read-Only):</label>\n    <textarea id=\"transcript-display\" readonly style=\"width: 100%; min-height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; line-height: 1.5; resize: vertical; pointer-events: none;\" placeholder=\"Your transcription will appear here as you speak...\"></textarea>\n    <p id=\"word-count\" style=\"margin-top: 5px; font-size: 12px; color: #9ca3af; text-align: right;\">0 words</p>\n  </div>\n  \n  <!-- Action Buttons -->\n  <div id=\"action-buttons\" style=\"display: none; gap: 10px; margin-top: 15px;\">\n    <button onclick=\"keepResponse()\" style=\"flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úì Keep Response</button>\n    <button onclick=\"deleteResponse()\" style=\"flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;\">‚úó Delete & Try Again</button>\n  </div>\n  \n  <!-- Success Message -->\n  <div id=\"success-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; color: #065f46;\">\n    ‚úì Response saved! You can proceed to the next question.\n  </div>\n  \n  <!-- Error Message -->\n  <div id=\"error-message\" style=\"display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #ef4444; border-radius: 6px; color: #991b1b;\"></div>\n</div>\n\n<script>\n(function() {\n  'use strict';\n  \n  // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT URL\n  const SHEET_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbzGzk7Zcb9invzxdO5mEVtoNX7bgXu-yWXagtjJ6B30mSNtxkwTsM_nB9B3tY2AdwCz/exec';\n  const QUESTION_ID = 'Check4'; // Will be replaced by CallVu\n  const QUESTION_TITLE = 'Check 4'; // Will be replaced by CallVu\n  const ANSWER_FIELD_ID = 'Answer_Check4'; // Will be replaced by CallVu\n  \n  // State\n  let recognition = null;\n  let isRecording = false;\n  let transcript = '';\n  let startTime = 0;\n  let timerInterval = null;\n  let repName = '';\n  let repEmail = '';\n  \n  // Initialize\n  function init() {\n    // Check browser support\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      showError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');\n      document.getElementById('record-btn').disabled = true;\n      return;\n    }\n    \n    // Initialize speech recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    recognition = new SpeechRecognition();\n    recognition.continuous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n    \n    recognition.onresult = function(event) {\n      let interim = '';\n      let final = '';\n      \n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        const result = event.results[i];\n        if (result.isFinal) {\n          final += result[0].transcript + ' ';\n        } else {\n          interim += result[0].transcript;\n        }\n      }\n      \n      if (final) {\n        transcript += final;\n        updateTranscript();\n      }\n      \n      if (interim) {\n        updateTranscript(interim);\n      }\n    };\n    \n    recognition.onerror = function(event) {\n      if (event.error === 'not-allowed') {\n        showError('Microphone access denied. Please enable microphone permissions.');\n      } else if (event.error !== 'no-speech') {\n        showError('Recognition error: ' + event.error);\n      }\n    };\n    \n    recognition.onend = function() {\n      if (isRecording) {\n        try {\n          recognition.start();\n        } catch (e) {\n          // Ignore\n        }\n      }\n    };\n    \n    // Get user info from CallVu form\n    setTimeout(getUserInfo, 1000);\n  }\n  \n  function getUserInfo() {\n    // Try to find name and email fields\n    const nameField = document.querySelector('[data-integration-id=\"RepName\"], [name*=\"RepName\"], input[name*=\"name\"]');\n    const emailField = document.querySelector('[data-integration-id=\"RepEmail\"], [name*=\"RepEmail\"], input[type=\"email\"]');\n    \n    if (nameField) repName = nameField.value || '';\n    if (emailField) repEmail = emailField.value || '';\n    \n    // Listen for changes\n    if (nameField) {\n      nameField.addEventListener('input', function() { repName = this.value; });\n    }\n    if (emailField) {\n      emailField.addEventListener('input', function() { repEmail = this.value; });\n    }\n  }\n  \n  function toggleRecording() {\n    if (!isRecording) {\n      startRecording();\n    } else {\n      stopRecording();\n    }\n  }\n  \n  async function startRecording() {\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      transcript = '';\n      startTime = Date.now();\n      isRecording = true;\n      \n      recognition.start();\n      \n      document.getElementById('record-btn').style.background = '#ef4444';\n      document.getElementById('record-btn').innerHTML = '‚èπ';\n      document.getElementById('record-btn').style.animation = 'pulse 1s infinite';\n      document.getElementById('record-hint').textContent = 'Recording... Click to stop';\n      document.getElementById('status-text').textContent = 'üî¥ Recording...';\n      document.getElementById('status-display').style.background = '#fee2e2';\n      document.getElementById('action-buttons').style.display = 'none';\n      document.getElementById('success-message').style.display = 'none';\n      hideError();\n      \n      startTimer();\n    } catch (err) {\n      showError('Could not access microphone. Please allow microphone permissions.');\n    }\n  }\n  \n  function stopRecording() {\n    isRecording = false;\n    recognition.stop();\n    clearInterval(timerInterval);\n    \n    document.getElementById('record-btn').style.background = '#3b82f6';\n    document.getElementById('record-btn').innerHTML = '‚è∫';\n    document.getElementById('record-btn').style.animation = 'none';\n    document.getElementById('record-hint').textContent = 'Click to record again';\n    document.getElementById('status-text').textContent = 'Stopped recording';\n    document.getElementById('status-display').style.background = '#fef3c7';\n    \n    if (transcript.trim()) {\n      document.getElementById('action-buttons').style.display = 'flex';\n    }\n  }\n  \n  function startTimer() {\n    timerInterval = setInterval(function() {\n      const elapsed = Math.floor((Date.now() - startTime) / 1000);\n      const mins = Math.floor(elapsed / 60);\n      const secs = elapsed % 60;\n      document.getElementById('timer').textContent = mins + ':' + secs.toString().padStart(2, '0');\n      document.getElementById('timer').style.color = '#ef4444';\n    }, 1000);\n  }\n  \n  function updateTranscript(interim) {\n    const display = document.getElementById('transcript-display');\n    display.value = transcript;\n    if (interim) {\n      display.value += ' ' + interim;\n    }\n    \n    const wordCount = transcript.split(/\\s+/).filter(w => w.length > 0).length;\n    document.getElementById('word-count').textContent = wordCount + ' words';\n    \n    // Update CallVu field if it exists\n    updateCallVuField();\n  }\n  \n  function updateCallVuField() {\n    const fieldId = ANSWER_FIELD_ID.replace('PLACEHOLDER', '');\n    if (fieldId && fieldId !== 'ANSWER_FIELD_ID_') {\n      const field = document.querySelector('[data-integration-id=\"' + fieldId + '\"], [name*=\"' + fieldId + '\"]');\n      if (field) {\n        field.value = transcript;\n        field.dispatchEvent(new Event('input', { bubbles: true }));\n        field.dispatchEvent(new Event('change', { bubbles: true }));\n      }\n    }\n  }\n  \n  function keepResponse() {\n    if (!transcript.trim()) {\n      showError('No response to keep. Please record your answer first.');\n      return;\n    }\n    \n    updateCallVuField();\n    logToSpreadsheet();\n    enableNextButton();\n    \n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'block';\n    document.getElementById('transcript-display').style.background = '#d1fae5';\n  }\n  \n  function deleteResponse() {\n    transcript = '';\n    document.getElementById('transcript-display').value = '';\n    document.getElementById('word-count').textContent = '0 words';\n    document.getElementById('action-buttons').style.display = 'none';\n    document.getElementById('success-message').style.display = 'none';\n    document.getElementById('transcript-display').style.background = 'white';\n    document.getElementById('timer').textContent = '0:00';\n    document.getElementById('timer').style.color = '#6b7280';\n    \n    updateCallVuField();\n    disableNextButton();\n  }\n  \n  function enableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = false;\n      nextButton.classList.remove('disabled', 'opacity-50');\n    }\n  }\n  \n  function disableNextButton() {\n    const nextButton = document.querySelector('button[type=\"submit\"], .next-button, [data-action=\"next\"]');\n    if (nextButton) {\n      nextButton.disabled = true;\n      nextButton.classList.add('disabled', 'opacity-50');\n    }\n  }\n  \n  async function logToSpreadsheet() {\n    if (!repName.trim() || !repEmail.trim()) {\n      console.warn('Missing name/email for spreadsheet logging');\n      return;\n    }\n    \n    const duration = Math.floor((Date.now() - startTime) / 1000);\n    const questionId = QUESTION_ID.replace('PLACEHOLDER', '');\n    const questionTitle = QUESTION_TITLE.replace('PLACEHOLDER', '');\n    \n    const payload = {\n      timestamp: new Date().toISOString(),\n      repName: repName.trim(),\n      repEmail: repEmail.trim(),\n      questionId: questionId !== 'QUESTION_ID_' ? questionId : '',\n      questionTitle: questionTitle !== 'QUESTION_TITLE_' ? questionTitle : '',\n      transcript: transcript.trim(),\n      recordingDuration: duration,\n      responseType: 'Voice'\n    };\n    \n    try {\n      if (SHEET_WEBHOOK_URL && SHEET_WEBHOOK_URL !== '') {\n        await fetch(SHEET_WEBHOOK_URL, {\n          method: 'POST',\n          mode: 'no-cors',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n      }\n    } catch (err) {\n      console.log('Webhook error:', err);\n    }\n  }\n  \n  function showError(message) {\n    const errorDiv = document.getElementById('error-message');\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n  \n  function hideError() {\n    document.getElementById('error-message').style.display = 'none';\n  }\n  \n  // Add pulse animation\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.7; }\n    }\n  `;\n  document.head.appendChild(style);\n  \n  // Initialize when page loads\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n})();\n</script>\n\n",
                    "localOnly": false
                  }
                ]
              },
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "Voice transcription will appear here. This field is read-only - voice input only.",
                    "identifier": "answer_Answer_Check4",
                    "integrationID": "Answer_Check4",
                    "isHiddenInRuntime": false,
                    "label": "Your Response",
                    "maskingViewer": "none",
                    "name": "editor.fields.longText",
                    "permission": "both",
                    "readOnly": false,
                    "required": true,
                    "tooltip": "",
                    "type": "longText",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "maxLength": 2000
                  }
                ]
              }
            ],
            "style": {
              "alignment": "",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": false,
        "text": "Check 4",
        "isLastStep": false
      },
      {
        "stepName": "Complete",
        "identifier": "step_complete",
        "buttonsConfig": {
          "back": {
            "className": "",
            "isHidden": true,
            "text": ""
          },
          "next": {
            "className": "",
            "isHidden": true,
            "text": ""
          },
          "targetStep": ""
        },
        "blocks": [
          {
            "blockName": "",
            "identifier": "block_complete",
            "icon": "",
            "rows": [
              {
                "fields": [
                  {
                    "className": "",
                    "clearable": false,
                    "hint": "",
                    "identifier": "para_1764884129197",
                    "integrationID": "",
                    "isHiddenInRuntime": false,
                    "label": "",
                    "maskingViewer": "none",
                    "name": "editor.fields.paragraph",
                    "permission": "both",
                    "readOnly": false,
                    "required": false,
                    "tooltip": "",
                    "type": "paragraph",
                    "validations": [],
                    "width": "full",
                    "columnID": 0,
                    "editedParagraph": "\n<h2 style=\"text-align: center; color: #1f2937; font-size: 28px; font-weight: 700; margin-bottom: 16px;\">üéâ Quiz Complete!</h2>\n<p style=\"text-align: center; color: #4b5563; font-size: 16px; line-height: 1.6;\">Thank you for completing the CallVu Sales Enablement Quiz.</p>\n<p style=\"text-align: center; color: #6b7280; font-size: 14px; margin-top: 8px;\">Your responses have been recorded and will be reviewed.</p>\n      ",
                    "localOnly": false
                  }
                ]
              }
            ],
            "style": {
              "alignment": "center",
              "nobackground": false,
              "noborders": false,
              "size": "full",
              "background": "#ffffff"
            },
            "type": "regular"
          }
        ],
        "style": {
          "alignment": ""
        },
        "hideFooter": true,
        "text": "Complete",
        "isLastStep": true
      }
    ],
    "templateType": 3,
    "thankYouPageMarkup": "",
    "theme": {
      "primary": "hsl(210, 100%, 45%)",
      "title": "#1c1c1c",
      "text": "#3b3b3b",
      "background": "hsl(0, 0%, 100%)",
      "blockBackground": "#ffffff",
      "headerText": "#1c1c1c",
      "font": "Inter-Regular",
      "headerBackground": "#ffffff",
      "secondary": "hsl(210, 80%, 95%)",
      "warning": "hsl(40, 97%, 47%)",
      "altBackground": "hsl(0, 0%, 97%)",
      "danger": "hsl(14, 80%, 50%)",
      "link": "hsl(209, 81%, 52%)",
      "success": "hsl(145, 94%, 32%)",
      "dark": "hsl(0, 0%, 29%)",
      "bright": "hsl(54, 100%, 81%)",
      "neutral": "hsl(124, 37%, 84%)"
    },
    "title": "Sales Enablement Quiz",
    "privateMode": false,
    "otpTemplateID": "",
    "isOTPEnabled": false,
    "otpVersion": 2,
    "formVersion": "10.4.40",
    "lastModified": "",
    "newRules": [],
    "Timestamp": "",
    "TimeModified": "",
    "style": "",
    "formCSS": {
      "ID": "",
      "Name": "",
      "Description": "",
      "CSS": ""
    },
    "id": null,
    "backgroundUrl": {
      "desktop": "",
      "mobile": ""
    }
  }
}